<style>
/* ===== PAGE FLIP ANIMATION ===== */
.book-page {
  display: none;
  background: #2b2b2b;
  border-radius: 12px;
  padding: 20px;
  margin-top: 20px;
  text-align: left;
  line-height: 1.5;
  transform-origin: left;
  transform-style: preserve-3d;
  backface-visibility: hidden;
  transition: transform 0.6s ease, opacity 0.6s ease;
  opacity: 0;
}
.book-page.active {
  display: block;
  opacity: 1;
  transform: rotateY(0deg);
}
.book-page.next {
  transform: rotateY(-180deg);
}
.book-controls {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}
.book-controls button {
  background: #4caf50;
  color: #fff;
  padding: 8px 16px;
  cursor: pointer;
  border-radius: 8px;
}
</style>

<!-- ===== PASSCODE SCREEN ===== -->
<div id="passcodeScreen" style="position:fixed; inset:0; background:#111; color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000;">
  <h2>Enter the passcode to unlock your world</h2>
  <input id="passcodeInput" type="text" placeholder="Hint: First kiss" style="padding:10px; font-size:1.2em; margin:10px;">
  <button onclick="checkPasscode()">Unlock</button>
  <p id="passcodeMessage" style="color:red;"></p>
</div>

<script>
// ===== FLOATING HEARTS =====
setInterval(() => {
  const heart = document.createElement("div");
  heart.className = "heart";
  heart.innerHTML = "ðŸ’–";
  heart.style.left = Math.random()*100 + "vw";
  document.body.appendChild(heart);
  setTimeout(() => heart.remove(), 5000);
}, 800);

// ===== PASSCODE FEATURE =====
function checkPasscode() {
  const code = document.getElementById("passcodeInput").value;
  if(code === "0727") {
    document.getElementById("passcodeScreen").style.display = "none";
  } else {
    document.getElementById("passcodeMessage").innerText = "Incorrect passcode!";
  }
}

// ===== CREATE BOOK FUNCTION WITH FLIP =====
function createBook(pages) {
  let container = document.createElement("div");
  container.className = "book-container";

  pages.forEach((text, index) => {
    let page = document.createElement("div");
    page.className = "book-page";
    if(index===0) page.classList.add("active");
    page.innerHTML = text;
    container.appendChild(page);
  });

  let controls = document.createElement("div");
  controls.className = "book-controls";
  let prev = document.createElement("button"); prev.innerText = "â¬…"; 
  let next = document.createElement("button"); next.innerText = "âž¡";
  controls.appendChild(prev); controls.appendChild(next);
  container.appendChild(controls);

  let current = 0;
  const pagesDivs = container.querySelectorAll(".book-page");

  function showPage(newIndex) {
    pagesDivs[current].classList.remove("active");
    if(newIndex>current) pagesDivs[current].classList.add("next");
    current = newIndex;
    pagesDivs[current].classList.add("active");
  }

  prev.onclick = () => { if(current>0) showPage(current-1); }
  next.onclick = () => { if(current<pagesDivs.length-1) showPage(current+1); }

  return container;
}

// ===== MODIFY openGift FUNCTION TO USE BOOK PAGES =====
const originalOpenGift = openGift;
openGift = function(type) {
  let content = "";
  if(type==="music") {
    content = [
      `<h2>Our Song ðŸŽµ</h2>
       <iframe width="100%" height="215" src="https://www.youtube.com/embed/dn5rSbHGsHY" frameborder="0" allowfullscreen></iframe>`
    ];
  }
  if(type==="memories") {
    content = [
      `<img src="https://raw.githubusercontent.com/Crisp482/birthday-world/a09022390802d42b9eb348b917210a02f3c3c0bd/1.jpeg" width="100%"><p>The first time you came by me, I was overjoyed you came, gave me hella butterflies.</p>`,
      `<img src="https://github.com/Crisp482/birthday-world/blob/main/2.jpeg?raw=true" width="100%"><p>One of my favorite little moments, it is so adorableeeee.</p>`,
      `<img src="https://github.com/Crisp482/birthday-world/blob/main/3.jpeg?raw=true" width="100%"><p>I can not get over your smile, the way your eyes just disappear and the chubby cheeksss eeee.</p>`,
      `<img src="https://github.com/Crisp482/birthday-world/blob/main/4.jpeg?raw=true" width="100%"><p>I loved this night with you.</p>`,
      `<img src="https://github.com/Crisp482/birthday-world/blob/main/5.jpeg?raw=true" width="100%"><p>Our late night talks really are what i cherish most about us.</p>`,
      `<img src="https://github.com/Crisp482/birthday-world/blob/main/6.jpeg?raw=true" width="100%"><p>Your tendency to piss me off never grow old and i love it.</p>`,
      `<img src="https://github.com/Crisp482/birthday-world/blob/main/7.jpeg?raw=true" width="100%"><p>Outing number 2, def needed more pictures...initmate ones i mean hehehe.</p>`
    ];
  }
  if(type==="letter") {
    content = [
      `<p>Happy Birthday, my love. I donâ€™t even know where to start, because seven months ago I never imagined Iâ€™d be building a whole little world just to say how much someone means to me.</p>
       <p>I wanted to give you something, even though it isn't as much as you have given me. I wanted to give you a place where you could slow down for a moment and feel what I feel every time I think about you.</p>`,
      `<p>Seven months isnâ€™t long by the calendar, but itâ€™s been long enough for you to become my favorite person to talk to, my comfort on hard days and my happiness on the good ones.</p>
       <p>Happy Birthday, my favorite player, my safe place, my person. Always yours, <strong>The love of your life, your woman, your man, your baby</strong> ðŸ’šðŸŽ®</p>`
    ];
  }

  let popup = document.getElementById("popup");
  let popupContent = document.getElementById("popupContent");
  popupContent.innerHTML = "";
  popupContent.appendChild(createBook(content));
  popupContent.innerHTML += '<br><button onclick="closeGift()">Close</button>';
  popup.style.display = "block";
};
</script>
